___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "popIn web popup",
  "categories": ["ADVERTISING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAPGElEQVR4nO2db4wU533Hv7/ZPc/YRYIXxMKYSKjyC1cyAW4WG0dGchLOctBVtZWrYtJedRdxlZEggpTdM6bIqpB9YsbiaG2JSGfrkM4SsUIDbUjBOqrQxlJI2D1TnV+gyqp4gTisWiqRSNgRu/vti51Lzoi729n598zu83l53nnmx/o7v33m9+8BNBqNRqPRaDQajUaj0WgiJZfkzcyCM5B/rO/D/Nq+XH1u+jdJ3rtbMW1nIL+278P8432s35wuJ3VfSepGZsF5FcA7AskDAMmLhmD4brl0IykbugnTdlcBnBCRgfm/kTzkVUpvJXH/RDyWVXAOCOQfBWLM/01E/hTA93Nrt39ev3nxahJ2dAtWr9sPwc9FZOvCv4vIt/KPvbCqNjf9Udw2xO6xLNsdh2DfUp8hedaAMXK3cuCLuO3pZB7Z4qyoN2RcBLuW+hyJ01Ytv/O3/7W/FpctsQlr5cbxfDVfmxDBUCufJ/gFiN1epXQ6Lps6GdN2ngdkUgTrW/k8yXM5Azt/f6V0Jw57YhGW+cyYhVp+SgQDy3/6y5A4CWC/Vynejt6yzsN8ZsySeu4IIAeCXkvw45zg23GIK3JhPbLFWVEnzgvkuXbXIHFDgJFqpXghSts6DbNwdCsgkwJ5st01CF6D4BveldKtKG2LVFjmFmcNGjgvIpuiWI/EuzmDB+Ny11mluc249zoEh+ffssNA8JpQXq5WiteisA+IUFim7a6H8HyYp+dBkLgOaez0yqOXo1w3q1i97lMUTkX18P4B4haIvupM8dMolotEWJbtPgngFxCsiWK9+yFYE+A4c/XD3q8PVuO4h+r4L0M/EOBNCKw47kHijhDfrs4UPw67VmhhWb3uczR4RiCrw661HAQ/BTHoVUpdFfcybXc9gFMi2LrcZ8NC4g6kMeiVR8+GWSeUsCzb3U7gjAhWhFknCARrII5YtZ634ozDqIJpO3sAGUvhOx70KqUft7tG28IyC84AgFNRbB7bgcRlEMPeTHQbTpV4uOCsaxATIvJiWjYQ3O+VS8fbubatlI5ZcPYAmEhLVAAggnUC7MqtfeFufW76V2nZEQdm4egQIP8iIk+laYdAXsw/1pevzU3/Ivi1ATFt53UReTPodXFC8hIgw16leD1tW8LwsP326gYaJxYmjlWA5LtWrWd/kK1HII9l2e7fish4cNPiRUTWA9iVf7zvf+s3p2dSNqctTNsZoPC8iBTStuV+ROTpmtF4qD43/e+tXhPsp0z4GwLXoo5VRUFzcysTZsH5CwPYnZVynGZ5C8ZbzammQTMTwpZFBQDG8h/5I9Vy6WpOsIXEu8FMSw6B9BOYNW1HqZ+TB2HZ7nYAs2qLiqcBbKhWSheDXNf2W6EfapgUwbp214gbkqcNGLtVK8fxy1vGRLAnbVsWh7dJjLRbbRIqjuVXKZ4QkVfCrBMnJG4Isbs6UzyXti2AnzimcarV8pY0IHnBEIyE2U5EktIxbWcAghNJRN/bhcTJnMG9aSW058tbCOxLM0yzFCTuADzoVUqhtzqRJaEfLjjrGsAJgfRHtWbUkLgOcNirlC4leV/TdjYBmIw8cRwhJC4DGPQqxc+iWC/yeiyr4LxKiptkCiIoJI8jXz8Yd0I76vKWOGimb+SQVcsfizJFFk8Fqe2uF3AK0n6xX9wQvAZwOK5yHLPXfRKCySQSx+1C8iqA4TiS+rF06dTnpm//yaM7pmpG47cQfmthd44q+PvBofzavodWfGXHL73PP2pEtbZpu/tE8BNVN+h+GdIx5Ot/5V15LZZ4X+xdOtnYX0Tz5DbLWzgpIs9HYlgMJLXPTKRhdeXG8bzXc29M6Tei5l5j1Krl/6mdvYZZcHaBMq723hLv5QzuT+LNOLFOaCArMZxgb0dZeBv2y45HkozlJbr38cqjl3MGNyidEmputj9pFtgtjWk7Aw3gE5VFRfK0QDYkHSBO1GMtxOp1+yk4oXhK6JIhGLw/Aq1qecuX4W2Ce73y6Adp3D21t7XqTPGcAdnsJzmVRESeJzDbLLxrYvW6/Q3wE5VFRfKSABvSEhWQosdaiFlwXhHgBCCr0rZlMQheAOW2CJTNi4KoEixGkZIJixLCAtSo8c4yqvUAKCOsedLoSskyqnYtKScsADBt9wkAUyqnQ1SA4DUQO1Xss1Qu1QIAXqX4mVXLbwNxiKAyT6FKkDyOXH2ziqICFPVYCzFtZxMEU4J0W6FUIa3Sn6AkOty2Hepz07fyX/3mpFAsAk+rmNBOCn922MtepaTEBn0plPdYCwk6ta5T8KcdjniVUqh5CkmSqaffq5Qu+Smh99K2JSlInjVo/FmWRAVkzGMtxOp1+2lwUuU6+zD4U1/2euXRk2nb0g6ZFRaQlZxdcDphZECmhTWPWTg6JJBxlVNCLUFUCRzyKsVjaZsSlo4QFvCHlNCUytWbS0HyKig7VUnJhKVjhDWPaTt7BOLGNU4xalRNyYSl44QFzHfIcErFyS0LibtTKE2UD5C2Q31u+osVj+6YrBn1OgTbVAyqNkeN47vV8uj/pG1LHHSkx1qIZTsFNlNCSoxe8g9HGK5WioGmt2QN5Z7kqKlWSmXk6ptJtjVLM1KIDwBs6HRRAV3gsRaSVkqoGw+g6niPtRC/ImCzn8xNBILnINjQTaICusxjLSTu0Usk7oiwWC2XfhTH+qrTtcIC/JSQNCYj7wskPyZkMMspmbB0tbDmMQtHh0DjndB19n5Kpt02/U5CC8sn7ECPOEcCZREtrPswbfeHQU7Y8mvy37bu9Rzudi+1EC2sB+CnhE4tN3pJn6W4OB2Z0gmLnxJ6v5arGwC+/qCUkH/663c6NSUTFu2xluH+c5dVG++tKlpYLeAP/B8FuAKQf/Aqxdtp26TRaDQajUaj0Wg0Go1Go9FoNBqNRqPRaDQajUaj0Wg0Go1G0za6grQFmudaywkAqwCOeJXSx2nbpDpaWMtwfzuYbvdqDS2sRVhupmmnzQyNmq6aNtMqpu0MEJhdqitaRDaJtHZ2dDeiPdYCTNtdJcA7EPx1kOtIXoCBYe9K6VZctmUNLSyfsEPZsnjeTZx0vbBWbhzPV3vuHQFwQCD5sOuReC9ncP/vr5TuRGBeZulqYbU6oyEoeqZDFwsr7oMGOvVggFbpOmGZW5w1aGBSRF5M4n4kLgMY9CrFz5K4nyp0VbjBtJ2XQMwmJSoA8A9M/8QqOK8mdU8V6AqP5Q/1GBfBrjTtIHnWgDFyt3LgizTtSIKOF5ZZOLoVNE4pc9wvcQvESKePQepYYa3cOJ6v5u+9DsHhKMIIUeMPbjvYqWGJjhSWabtPAJjy9zfKQvAaiJ2dOBC344RlFZxXSXFDj9ZOiGZYQg5ZtfyxTgpLdIyw/POhJ0TkpbRtaYsOO3SgI8INVq/bT3A2s6ICAJHnAMyahaOBEuCqkmmP5YcRxkTQUaUrJE8DMpLlWaeZFZZpO5sgOKXKAZdRk/UDMzMnrGYYofZDCN9UMYwQNSSPI18/6P36YDVtW4KQKWGZtrtewCl/P9I1ZPGcnsycTGEWjg4B8jMReSJtW5JGRNYIZCi39oW79bnpX6VtTyso77FM210FcEJEBtK2RQVIXjIEg3fLpRtp27IUSocbLNvdjmZTgxaVj4g8T2DWtB2lvxMlPZb5zJiFWm5MRPalbYvSEB8Q2KtiWEI5YflhhCmBPJW2LVmAxHWAw/5B6sqglLCCHkKpaUKwJsBx817PQVXyjUoIa7muY01rqNSdnfrm3Sw4ryzXdZw2JG6A/EuQfQRT/5+2GCp1Z6fmsdrtOk4aEicB7J/fIJvPjFlSzx0hsE/lyD/JC4ZgJK2wRCrCCtt1nATLnaR6/8mrKpJmd3aiwlq5cTzv9dwbU/9p/7KXWozseK/ku7MTE1ZcXcdR0u55z5nwXgl3ZyeSKzRtZ4+I/LOIrEvifu3gNze8fLdS+jTotfWbF2/kv/rN94ViEXj6Qafep40IVgEYyq/te2jFV3b80vv8o0as94tzcT+MMJFkg2hQog4wNtvN5ITinjn27uzYPJZpOy9R8HMR+Vpc9wiL76W+Uy2X/juqNes3L95Y8eiO92tGvQ7BNkW91zoA3+95vO//ajeny7HcI+oFVek6Xoqk0iDNobiYVNp7gecMGsNRd2dH+jSZhaNb6w2ZVVxU7+YMbkgit+ZVSletWs8Wkm/4Q3GVQyD9BGetXrc/2nUjwB9e9gaA11R97U47WZsJ7xVhd3ZoYWWh61iVdnbV2/6BZne2EIPVSinU3iuUsFTvOk7bSy2G6t4riu7stoT1sP326oY0JgUS6e9yVPhfzI9U8FKLkQXvFaY7O7CwrF63nwYnBbI66LVJ0Kw+4HBW5n8q772IO5DGXq88ejLIdYHiWKbtDomBDwXySCDrEsAvdjuGXP273pXXrqdtT6vU56ZvNeNejd8JsA0CpbyXCB4SyEu5x/pYn5v+j1avC/SPEOFVUG5BsCa4ifEx76WqGfFS9+PvYxyz1/1XAJOqvQiRuCOU/wxyTaA4VrVcukrgWVWK3ZqxIb6NXH1zVn76lsKbKV6zavltJP4OhBqdz8QtIZ6tzhQvBbmsrc273+t3Js2qz6ztpYLSrAZJ13sR/BSCvnaOcmkr8u5ViretWk8fyQ/auT4MnealFiNt70XyQk7wbLvnA4UOkFq2cwQifx92nVbodC+1GEl7LxLvWbX87jAdP5GkdMyCMwRgIq54zHx7E3P1w1mbuhIV/pSdH8TdHkfykFcpvRV2nciqGyzb3U7gTNRReJJXIdzdbV5qMeLyXv4RLYNepfTjKNaLrLqhWileFOJZEpF0hRCskXzDqvVs0aL6I/HsvXhbGvKNqEQFxFCP5Z9Vcz5MJDmL86DSwLTd9QAnw72d8zNQ/rxaibbJNZbS5GaxH34StCS520/Mapdmg6qMBd2GELwMwctxnAwbW837yo3jeS9/7x2ItHQ4kfZS4QjqvUiczRkcjCtJH3v7l2k7r4nI2GL/XXupaGnJexHHzVq+GOf3nUhfoWk7rwhk8v7XZO2l4mEx7+WXRxe9cul43DYk1rBq9brP0eAZgazWXioZFnovv/xl0CuPJtJun2iLvWm7T4jge2jgp9WZYuDGUE1wTNtdL4K/AflvYcuNNRqNRqPRaDQajUajaY3/B8UEN8thzQaMAAAAAElFTkSuQmCC"
  },
  "description": "Install popIn web popup easily to your site without the need to write a line of code.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "popin_popup_cid",
    "displayName": "campaign_id",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// 在此输入您的模板代码。
const log = require('logToConsole');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');


const popin_popup_cid = data.popin_popup_cid;
const isCidSetSuccess = setInWindow('popin_popup_cid', popin_popup_cid, true);

log('data =', data);
log('isCidSetSuccess =', isCidSetSuccess);

// 加载js
if (isCidSetSuccess) {
  const pixelUrl = 'https://static.popin.cc/js/popup.js';
  injectScript(pixelUrl, data.gtmOnSuccess, data.gtmOnFailure, 'popin_web_popup_script');
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "popin_popup_cid"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.mediago.io/*"
              },
              {
                "type": 1,
                "string": "https://api.popin.cc/*"
              },
              {
                "type": 1,
                "string": "https://log.popin.cc/*"
              },
              {
                "type": 1,
                "string": "https://static.popin.cc/*"
              },
              {
                "type": 1,
                "string": "https://chatup.popin.cc/*"
              },
              {
                "type": 1,
                "string": "https://trace.popin.cc/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: test
  code: "const mockData = {\n  // Mocked field values\n  popin_popup_cid: '1123'\n\
    \  \n};\n\n// Call runCode to run the template's code.\nrunCode(mockData);\n\n\
    // Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"


___NOTES___

Created on 2024/2/29 15:17:57


